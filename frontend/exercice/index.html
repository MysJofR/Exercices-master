<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LogiC</title>





    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet">
    <style>
        /* Estilos personalizados */
        #sideBar {
            right: -300px; /* Esconde a sidebar completamente */
            transition: right 0.5s ease; /* Adiciona uma transição suave para a animação */
        }
        
        .main-content-push {
            transition: margin-right 0.5s ease; /* Adiciona uma transição suave para empurrar o conteúdo principal */
        }
        #criar {
            display: none;
        }
    </style>

    <script src="https://cdn.tailwindcss.com"></script>
</head>
<style>
  




.loading {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

.loadingContainer {
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
    
}

.loader {
    position: relative;
    display: flex;
}

.loader span {
    position: relative;
    width: 250px;
    height: 250px;
    
    border-radius: 50%;
    box-shadow: -8px -8px 15px rgba(255, 255, 255, 1),
                8px 8px 25px rgba(255, 255, 255, 0.2);
    overflow: hidden;
}

.loader span::before {
    content: "";
    position: absolute;
    inset: 0;
    border-radius: 50%;
    box-shadow: inset 10px 10px 20px rgba(0, 0, 0, 0.5),
                inset -5px -5px 15px rgba(255, 255, 255, 1);
}

.loader span::after {
    content: "";
    position: absolute;
    inset: 40px;
    background: #eaeef0;
    border: 3px solid #eaeef0;
    border-radius: 50%;
    box-shadow: -8px -8px 25px rgba(255, 255, 255, 1),
                8px 8px 25px rgba(0, 0, 0, 0.25),
                inset 3px 3px 10px rgba(0, 0, 0, 0.15),
                inset -1px -1px 15px rgba(255, 255, 255, 1);
}

.loader span i {
    position: absolute;
    inset: 0;
    border-radius: 50%;
    background: linear-gradient(#42abff, #1eec0b);
    animation: animateLoader 1s linear infinite;
}

@keyframes animateLoader {
    0%
    {
        transform: rotate(0deg);
    }
    100%
    {
        transform: rotate(360deg);
    }
}

.rocket {
    position: absolute;
    inset: 50px;
    z-index: 10;
    border-radius: 50%;
    display: flex;
    justify-content: center;
    align-content: center;
    overflow: hidden;
}

.rocket .fa-rocket {
    position: absolute;
    top: 35%;
    color: #ee2727;
    font-size: 3.5em;
    -webkit-text-stroke: 2px #000;
    animation: animateRocket 0.2s linear infinite;
}

@keyframes animateRocket {
    0%,100%
    {
        transform: translate(0,0) rotate(-45deg);
    }
    50%
    {
        transform: translate(0,3px) rotate(-45deg);
    }
}

.rocket .fa-cloud {
    position: absolute;
    top: calc(45px * var(--i));
    left: calc(40px * var(--i));
    font-size: 2em;
    color: #fff;
    -webkit-text-stroke: 2px #000;
    animation: animateCloud 1.5s linear infinite;
    animation-delay: calc(-0.5s * var(--i));
}

@keyframes animateCloud {
    0%
    {
        transform: translateY(calc(-35 * 5px));
    }
    100%
    {
        transform: translateY(calc(35 * 5px));
    }
}
</style>



<body  class="bg-gradient-to-r from-gray-400  to-blue-400" onLoad="onLoad()">
   

    <div class="loading">
        <div class="loadingContainer">
            <div class="loader">
              <div class="rocket">
                <i class="fas fa-rocket"></i>
                <i class="fas fa-cloud" style="--i:0"></i>
                <i class="fas fa-cloud" style="--i:1"></i>
                <i class="fas fa-cloud" style="--i:2"></i>
                <i class="fas fa-cloud" style="--i:3"></i>
              </div>
              <span>
                <i></i>
              </span>
            </div>
          </div>
        
        </div>

    <nav class="bg-gradient-to-r from-gray-400  to-blue-400 absolute top-0 left-0 right-0 z-50 w-full h-16 flex justify-between items-center px-4">
        <div>
            <p  class="text-2xl font-bold ml-4 text-gray-900 font-bold focus:outline-none transition duration-300 hover:text-gray-100">LogiC</p>
        </div>
        <div class="flex items-center space-x-4">
            
            <button id="menuBtn" onclick="toggleSideBar()" class="text-gray-900 focus:outline-none transition duration-300 hover:text-gray-100">
                <i class="fas fa-bars text-xl animate-fadeIn"></i>
            </button>
        </div>
    </nav>
    
    <div id="sideBar" class="fixed inset-y-0 top-0 w-64 bg-gray-900 text-white shadow-lg z-50">
      <div id="profileDiv" class="flex  flex-row top-0 w-full text-gray-300 m-4">
        <img id="profilePicture" src="" class=" rounded-lg absolute left-0 ml-2 w-10 h-10 animate-fadeIn" >
        <a id="profile" class="absolute  text-xs left-10 ml-8 w-5/6 h-8 animate-fadeIn">
    
            <a id="schoolId" class="absolute mt-4  text-xs left-10 ml-8 w-5/6 h-8 animate-fadeIn"></a>
        </a>
       
        <button onclick="toggleSideBar()" class="absolute right-0 mr-2 focus:outline-none hover:text-white animate-fadeIn">
            <i class="fas fa-times"></i>
        </button>
        </div>
        <div id="abas" class="flex mt-12 flex-col justify-center w-full text-gray-300 m-4 animate-fadeIn"  >
            <a href="/" class="flex mb-2 items-center space-x-2 text-sm hover:underline hover:text-white">
                <i class="fas fa-home"></i>
                <span>Inicio</span>
            </a>
    
    
          
    
            <a href="/ajuda" class="flex mb-2 items-center space-x-2 text-sm hover:underline hover:text-white">
                <i class="fas fa-question-circle animate-fadeIn"></i>
                <span>Ajuda</span>
            </a>
    
            <a href="/login" onclick="logout()" class="flex items-center space-x-2 text-sm hover:underline hover:text-white">
                <i class="fas fa-sign-out-alt animate-fadeIn"></i>
                <span>Sair</span>
            </a>
    
        </div>
    </div>
           

<div id="lista"  class="flex flex-col justify-center mt-20 items-center w-6/6 mr-10 ml-10 3/6">
        <table class="min-w-full bg-white border border-gray-200">
            <thead>
                <tr>
                    <th class="px-6 py-3 border-b border-gray-200 bg-gray-50 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">Lista de Exercicios</th>
                  
                </tr>
            </thead>
            <tbody id="exerciceTableBody">
               
            </tbody>
        </table>
    </div>
        

 

<script>


function loading(){

const load = document.querySelector('.loading')
load.style.display = 'block'
}

const textarea = ` 
          <p class="flex flex-row self-start block mb-2 ml-3 text-sm font-semibold text-white dark:text-white" id="codeL">Código exemplar: </p>
       <textarea id="code" cols="20" rows="10" class=" mb-3 bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500" onkeydown="if(event.keyCode===9){var v=this.value,s=this.selectionStart,e=this.selectionEnd;this.value=v.substring(0, s)+'\t'+v.substring(e);this.selectionStart=this.selectionEnd=s+1;return false;}" >programa {
            funcao inicio() {
              
            }
          }
       </textarea>`
</script>



         
      
      

       
       



        





    <script> 

  
       



  async function findExerciceByName(name){
   
        var requestOptions = {
            method: 'GET',
            headers: {
                "Content-Type": "application/json",
                "Accept": "application/json",
                "Access-Control-Allow-Origin": "*",
                "token": localStorage.getItem("token")
                        
            },
            redirect: 'follow' }
           
            fetch("http://localhost:3000/exercice/list", requestOptions)
        .then(async (response) => {

            const data = await response.json();
            
if (response.status == 200) {
  console.log(data)
for(let i in data){
 
    if(data[i].name == name){ 
       
       
      return data[i]
     
        
        
        } 
   
        
}
  
  
             
    
} else {
    window.location.href = '/';
   throw new Error(data.message || "Erro ao procurar exercicio");
   
}

}).catch((err) => {
    console.log(err)
    throw new Error(err)
})

    }


    async function update(exercice){
        const usersDone = document.getElementById('usersDone')
        const schoolId = []
        const usersChild = usersDone.childNodes.forEach((e) => {
        schoolId.push(e.innerText.slice(0,8))
        }
        )

        console.log(schoolId)
        const difficulty = document.getElementById('difficultyUpdate').value
        
        console.log(exercice)


      
        const newStatement = document.getElementById('statementUpdate').value
        const checkDifficulty = document.getElementById('newDifficulty').checked



console.log(newStatement,checkDifficulty,difficulty,document.getElementById('newInputs').checked,document.getElementById('inputsUpdate').value.split(','),exercice.tests[0].input,
exercice.tests[0].output, document.getElementById('outputUpdate').value)
         try {
    
    

   

     var requestOptions = {
         method: 'PUT',
         headers: {
            "Content-Type": "application/json",
                "Accept": "application/json",
                "Access-Control-Allow-Origin": "*",
                "token": localStorage.getItem("token")


         },
         redirect: 'follow',
         body: JSON.stringify({
            exerciceId: exercice.id,
   statement: newStatement!=''?newStatement:exercice.statement,
   tests:document.getElementById('newInputs').checked? [{input: document.getElementById('inputsUpdate').value.split(','),
         output: document.getElementById('outputUpdate').value}]:[{input: exercice.tests[0].input, output:exercice.tests[0].output}],
   doneBy: schoolId,
   difficulty:checkDifficulty? difficulty:exercice.difficulty
         })
        
        }
        
     

      fetch("http://localhost:3000/exercice/update", requestOptions)
     .then(async (response) => {

const data = await response.json();
     
    
     if (response.status===200) {
         console.log(data)
         window.location.reload()
        
     }else{
        console.log(data)
         localStorage.removeItem("token");
       // window.location.href = '/login'
     }

   
    })
 } catch(err) {
    console.log(err);
   localStorage.removeItem("token");
   //window.location.href = '/login'
}

} 
    



async function doneBy(){
    const editorDiv = document.getElementById('editor')
    editorDiv.style.display = 'block'
   const select = document.getElementById('exercices')
   

   var requestOptions = {
            method: 'GET',
            headers: {
                "Content-Type": "application/json",
                "Accept": "application/json",
                "Access-Control-Allow-Origin": "*",
                "token": localStorage.getItem("token")
                        
            },
            redirect: 'follow' }
           
            fetch("http://localhost:3000/exercice/list", requestOptions)
        .then(async (response) => {

            const data = await response.json();
            console.log(data)
if (response.status == 200) {

for(let i in data){
    const option = document.createElement('option')
    
    select.appendChild(option)
    option.className = 'p-4'
    option.innerHTML = `${i+1} - ${data[i].statement}`
    select.value = ''
   
    
}
  
  
             
    
} else {
    window.location.href = '/';
   throw new Error(data.message || "Erro ao enviar exercício");
   
}
        

}).catch((err) => {
    console.log(err)
    throw new Error(err)
})

}
  
async function onLoad() {
    
try {
    
    var myHeaders = new Headers();
    myHeaders.append("token", localStorage.getItem("token"));

    var urlencoded = new URLSearchParams();
    urlencoded.append("token", localStorage.getItem("token"));

    var requestOptions = {
        method: 'POST',
        headers: myHeaders,
        body: urlencoded,
        redirect: 'follow'
    };

    const response = await fetch("http://127.0.0.1:3000/auth", requestOptions)

    const data = await response.json();
   
    getUser()
   await listarExercicios()
 
    if (data.valid != true) {
        
        localStorage.removeItem("token");
      // window.location.href = '/login'
    }

   

} catch(err) {
   console.log(err);
    localStorage.removeItem("token");
   // window.location.href = '/login'
}

}

async function search(){

        
        try { 
            var myHeaders = new Headers();
            myHeaders.append("Content-Type", "application/x-www-form-urlencoded");
            myHeaders.append("token", localStorage.getItem("token"));

            var requestOptions = {
                method: 'GET',
                headers: myHeaders,
                redirect: 'follow'
            };

            const response = await fetch("http://127.0.0.1:3000/list/auth", requestOptions)
            const data = await response.json();

            if(response.status == 200){
               
                const sendBtn = document.getElementById('upd')
                const backBtn = document.getElementById('back')
                const div = document.getElementById('users')
           const input = document.getElementById('user').value;
          console.log(input)
      
      const dados = data.users.map((e) => {
            if(e.schoolId.includes(input) || e.fullname.includes(input)) {
                return {
                    fullname: e.fullname,   
                    schoolId: e.schoolId,
                    exercisesDone: e.exercisesDone
                }
            }
           })
   
    
            div.textContent = ''
          for(let i in dados){
           
            
            if(dados[i]){
                
           const a = document.createElement('a')
       const origin = document.getElementById('addDoneBy')
       const checkbox = origin.cloneNode()
                checkbox.style.visibility = 'visible'
           div.appendChild(a)
            a.className = 'flex flex-row'
              
              
                
              
            a.innerHTML = dados[i].schoolId + ' - ' + dados[i].fullname
            const usersDone = document.getElementById('usersDone')
              for(let i in usersDone.childNodes){
                if(usersDone.childNodes[i].innerText == a.innerHTML) checkbox.checked = true
              }
            a.appendChild(checkbox)
           
            }
          }
    
            }
        } catch (err) {
            console.log(err);
            localStorage.removeItem("token");
            window.location.href = '/login';
        
    }

    }




function exercice(exercice){

      
       if(document.getElementById('IoC').checked || !document.getElementById('randomData').checked){
        var requestOptions = {
            method: 'POST',
            headers: {
                "Content-Type": "application/json",
                "Accept": "application/json",
                "Access-Control-Allow-Origin": "*",
                "token": localStorage.getItem("token")
                        
            },
            redirect: 'follow',
            body:  JSON.stringify({
            statement:  document.getElementById('statement').value,
            difficulty:document.getElementById('difficulty').value,
            genRandomData: document.getElementById('randomData').checked,
            code: (document.getElementById('randomData').checked)?document.getElementById('code').value.replace(/\s/g, '\n'):undefined,
            entries:(document.getElementById('randomData').checked)?document.getElementById('entries').value.split(","):undefined,
            ioData: [{inputs: document.getElementById('ioData').value.split(','),
        output: document.getElementById('ioDataO').value}]         

            }),
            
        }
       }else{ 
        var requestOptions = {
            method: 'POST',
            headers: {
                "Content-Type": "application/json",
                "Accept": "application/json",
                "Access-Control-Allow-Origin": "*",
                "token": localStorage.getItem("token")
                        
            },
            redirect: 'follow',
            body:  JSON.stringify({
            statement:  document.getElementById('statement').value,
            difficulty:document.getElementById('difficulty').value,
            genRandomData: document.getElementById('randomData').checked,
            code: (document.getElementById('randomData').checked)?document.getElementById('code').value.replace(/\s/g, '\n'):undefined,
            entries:(document.getElementById('randomData').checked)?document.getElementById('entries').value.split(","):undefined,
                      

            }),
            
        }
       }
       
        

            fetch("http://localhost:3000/exercice/add", requestOptions)
        .then(async (response) => {

            const data = await response.json();

if (response.status == 201) {

   window.location.reload()
} else {
   console.log('Erro ao criar exercicio') 
   throw new Error(data.message || "Erro ao enviar exercício");
   window.location.href = '/'
}

}).catch((err) => {
    alert(err)
    throw new Error(err)
})

      
}


 function expandExercice(exercice){
    if(document.querySelector('.dropdown')){
        document.querySelector('.dropdown').remove()
    }
    const tbody = document.getElementById('exerciceTableBody')
   
    let exerciceNode;
    for(let i = 1; i<tbody.childNodes.length; i++){
        console.log(tbody.childNodes[i].childNodes[1].innerText)
        if(tbody.childNodes[i].childNodes[1].innerText == exercice.name){
            
            exerciceNode = tbody.childNodes[i]
            
        }   
            
        }
        const dropdownTr = document.createElement('tr')
        dropdownTr.classList = 'dropdown'
        console.log(exercice)
        if(exercice.tests.length>0){
        for(let t in exercice.tests){
            const outputTd = document.createElement('td')
            outputTd.innerText = 'Saída: '+ exercice.tests[t].output
         
            const inputTd = document.createElement('td')
            inputTd.innerText = 'Inputs: ' + exercice.tests[t].input
            
            dropdownTr.appendChild(inputTd)
            dropdownTr.appendChild(outputTd)
        }}

        exerciceNode.insertAdjacentElement('afterend', dropdownTr)
        const button = document.getElementById(exercice.name)
        button.innerText = '▲'
        button.onclick = () => {
            closeDropdown(exercice)

        }
        
    }
function closeDropdown(exercice){
    const dropdown = document.querySelector('.dropdown')
    dropdown.remove()
    console.log(dropdown)
    const button = document.getElementById(exercice.name)
    button.innerText = '▼'
    button.onclick =()=> { expandExercice(exercice)
    }
}
async function listarExercicios(){
    const lista = document.getElementById('lista')
    const tbody = document.getElementById('exerciceTableBody')
   
    const exercicios = await getExercices()
    
 const load = document.querySelector('.loading')
         load.style.display = 'none'
          lista.style.display = 'block'
    for(let i in exercicios){
        const tr = document.createElement('tr')

      tr.classList = 'p-8'
      const button = document.createElement('td')
      button.id = exercicios[i].name
      button.classList= 'px-6 py-4 border-b border-gray-200'
      button.innerText = '▼'
     button.onclick =()=> { expandExercice(exercicios[i])
     }
        tr.innerHTML = `  
         <td class="px-6 py-4 border-b border-gray-200">${exercicios[i].name}</h3>
                <td class="px-6 py-4 border-b border-gray-200">${exercicios[i].statement}</h3>
                <td class="px-6 py-4 border-b border-gray-200">Nivel da Dificuldade: ${exercicios[i].difficulty}</p>
                <td class="px-6 py-4 border-b border-gray-200">Data de Criação: ${exercicios[i].createdAt}</p>
                <td class="px-6 py-4 border-b border-gray-200">Última Atualização: ${exercicios[i].updatedAt}</p>
           
`
                       
                    tr.appendChild(button)

                 
          


                
           tbody.appendChild(tr) 

    }
    

}


  

async function getExercices(){
   
    var requestOptions = {
            method: 'GET',
            headers: {
                "Content-Type": "application/json",
                "Accept": "application/json",
                "Access-Control-Allow-Origin": "*",
                "token": localStorage.getItem("token")
                        
            },
            redirect: 'follow' }
           
         const response = await fetch("http://localhost:3000/exercice/list", requestOptions)
         const data = await response.json();
        if (response.status == 200) {
         if(data.length>0){
return data

    }else{

       return 'Não há nenhum exercício à ser listado'
    }
    
} else {
    window.location.href = '/';
   throw new Error(data.message || "Erro ao enviar exercício");
   
}

}

     






async function excluir(s){
    
   
      
       var requestOptions = {
            method: 'DELETE',
            headers: {
                "Content-Type": "application/json",
                "Accept": "application/json",
                "Access-Control-Allow-Origin": "*",
                "token": localStorage.getItem("token")
                        
            },
            redirect: 'follow',
            body:  JSON.stringify({statement: s
            })      
                  
        };
         await fetch("http://localhost:3000/exercice/delete", requestOptions)
        .then(async (response) => {

            const data = await response.json();

if (response.status == 200){
  window.location.reload()
} else {
   console.log('Erro ao excluir')
// window.location.href = '/'
   throw new Error(data.message || "Erro ao enviar exercício");
}

}).catch((err) => {
    
    console.log(err)    
    throw new Error(err)
})
        }

    
    
    


function logout(){
    localStorage.removeItem("token");
       window.location.href = '/login'
}
  
async function getUser(){
        try { 
            var myHeaders = new Headers();
            myHeaders.append("Content-Type", "application/x-www-form-urlencoded");
            myHeaders.append("token", localStorage.getItem("token"));

            var requestOptions = {
                method: 'GET',
                headers: myHeaders,
                redirect: 'follow'
            };

            const response = await fetch("http://127.0.0.1:3000/me", requestOptions)
            const data = await response.json();

            if(response.status == 200){
                
                document.getElementById('profile').innerText = data.fullname;
                document.getElementById('schoolId').innerText = data.schoolId;
                document.getElementById('profilePicture').src = data.profilePicture;
                return data
            }
        } catch (err) {
            console.log(err);
            localStorage.removeItem("token");
            window.location.href = '/login';
        }
    }


function toggleSideBar() {
        var sideBar = document.getElementById('sideBar');
        var mainContent = document.querySelector('.main-content-push');
        if (sideBar.style.right === '-300px' || sideBar.style.right === '') {
            sideBar.style.right = '0';
            mainContent.style.marginRight = '300px'; // Empurra o conteúdo principal para a direita
        } else {
            sideBar.style.right = '-300px';
            mainContent.style.marginRight = '0'; // Retorna o conteúdo principal ao seu lugar original
        }
    }
  
  </script>





</body>
</html>